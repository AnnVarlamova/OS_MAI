all:
	g++ -fPIC -c lib1.cpp -o d1.o
	g++ -fPIC -c lib2.cpp -o d2.o
#   -с компилирует файл без линковки
#   -fPIC position-independent code (PIC)
# 	предполагается, что общая библиотека будет совместно использоваться между процессами,
#	но не всегда возможно загрузить библиотеку по одному и тому же адресу в обоих.
#	Если бы код не был независимым от позиции, то каждому процессу потребовалась бы его собственная копия

	g++ -shared -o libd1.so d1.o
	g++ -shared -o libd2.so d2.o
#   -shared общая библиотека

	g++ -o prog2.o -c prog2.cpp
	g++ prog2.o -L. -ldl -o main2.out -Wl,-rpath -Wl,.
	g++ prog1.cpp -L. -ld1 -o main1.out -Wl,-rpath -Wl,.
#	-L. искать библиотеки в этой директории
#	-l + библиотека, с которой хотим линковать (указывает на библиотеку)
#   -Wl,-rpath -Wl,. указать ld путь к библиотеке вместо export LD_LIBRARY_PATH